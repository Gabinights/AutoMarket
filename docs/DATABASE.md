Entidade:

Utilizador (USERNAME, NOME, EMAIL, CONTACTOS, PASSWORD, MORADA) 



Veiculo ( MATRICULA, MARCA, MATRICULA, COR, CATEGORIA, CAIXA, ANO, MODELO, KM, TIPO, COMBUSTIVEL)



anuncio(ID, IMAGEM, DESCRIÇÃO, VALOR, ESTADO)



denuncias(ID, ID\_ALVO, MOTIVO, DATA\_ABERTURA, DATA\_FECHO, ESTADO)

Especializações:

AlvoDenuncia(ID,UTILIZADOR, ANUNCIO)



vendedor( ID\_UTILIZADOR, ID\_Tipo, ID\_Lista FATURAÇÃO, NIF) 



TipoVendedor(ID, EMPRESA, PARTICULAR)



ListaVendedor(ID, RESERVAS, VENDAS)



comprador( ID\_UTILIZADOR, ID\_Historico, LISTAFAVS)



HistoricoComprador(ID,RESERAVAS, VISITAS)



admin( ID\_UTILIZADOR, ESTATISTICAS)









Relacionamentos:

comprar(ID\_COMPRADOR, ID\_VEICULO, ESTADO DE PAGAMENTO)



reservar( ID\_COMPRADOR, ID\_ANUNCIO, ID\_DATA)



DataReserva(ID, DIA, HORA)



consultar(ID\_COMPRADOR, ID\_ANUNCIO)



fazer(ID\_UTILIZADOR, ID\_DENUNCIA) 



gerir( ID\_ADMIN, ID\_UTILIZADOR, ID\_DENUNCIA, ID\_ANUNCIO) 



criar( ID\_VENDEDOR, ID\_ANUNCIO) 



vender( ID\_VENDEDOR, ID\_VEICULO)



marcar visita( ID\_COMPRADOR, ID\_ANUNCIO)









1	Codigo SQL:

2	

3	-- ==========================================

4	-- SCRIPT DE CRIAÇÃO DE BASE DE DADOS MARKETPLACE DE VEÍCULOS

5	-- ==========================================

6	

7	-- (1) Criar base de dados

8	CREATE DATABASE Marketplace;

9	GO

10	USE Marketplace;

11	GO

12	

13	-- ==========================================

14	-- (2) TABELAS PRINCIPAIS

15	-- ==========================================

16	

17	CREATE TABLE Utilizador (

18	    USERNAME VARCHAR(50) PRIMARY KEY,

19	    NOME VARCHAR(100) NOT NULL,

20	    EMAIL VARCHAR(100) UNIQUE NOT NULL,

21	    CONTACTOS VARCHAR(20),

22	    PASSWORD VARCHAR(200) NOT NULL,

23	    MORADA VARCHAR(200)

24	);

25	

26	CREATE TABLE Veiculo (

27	    MATRICULA VARCHAR(15) PRIMARY KEY,

28	    MARCA VARCHAR(50) NOT NULL,

29	    COR VARCHAR(30),

30	    CATEGORIA VARCHAR(50),

31	    CAIXA VARCHAR(30),

32	    ANO INT,

33	    MODELO VARCHAR(50),

34	    KM INT,

35	    TIPO VARCHAR(50),

36	    COMBUSTIVEL VARCHAR(30)

37	);

38	

39	CREATE TABLE Anuncio (

40	    ID INT IDENTITY(1,1) PRIMARY KEY,

41	    IMAGEM VARCHAR(255),

42	    DESCRICAO VARCHAR(500),

43	    VALOR DECIMAL(10,2),

44	    ESTADO VARCHAR(30)

45	);

46	

47	CREATE TABLE Denuncias (

48	    ID INT IDENTITY(1,1) PRIMARY KEY,

49	    ID\_ALVO INT,

50	    MOTIVO VARCHAR(255),

51	    DATA\_ABERTURA DATE,

52	    DATA\_FECHO DATE,

53	    ESTADO VARCHAR(30)

54	);

55	

56	CREATE TABLE AlvoDenuncia (

57	    ID INT IDENTITY(1,1) PRIMARY KEY,

58	    UTILIZADOR VARCHAR(50),

59	    ANUNCIO INT,

60	    FOREIGN KEY (UTILIZADOR) REFERENCES Utilizador(USERNAME),

61	    FOREIGN KEY (ANUNCIO) REFERENCES Anuncio(ID)

62	);

63	

64	CREATE TABLE TipoVendedor (

65	    ID INT IDENTITY(1,1) PRIMARY KEY,

66	    EMPRESA BIT DEFAULT 0,

67	    PARTICULAR BIT DEFAULT 0

68	);

69	

70	CREATE TABLE ListaVendedor (

71	    ID INT IDENTITY(1,1) PRIMARY KEY,

72	    RESERVAS INT DEFAULT 0,

73	    VENDAS INT DEFAULT 0

74	);

75	

76	CREATE TABLE Vendedor (

77	    ID\_UTILIZADOR VARCHAR(50) PRIMARY KEY,

78	    ID\_Tipo INT,

79	    ID\_Lista INT,

80	    FATURACAO VARCHAR(255),

81	    NIF VARCHAR(20),

82	    FOREIGN KEY (ID\_UTILIZADOR) REFERENCES Utilizador(USERNAME),

83	    FOREIGN KEY (ID\_Tipo) REFERENCES TipoVendedor(ID),

84	    FOREIGN KEY (ID\_Lista) REFERENCES ListaVendedor(ID)

85	);

86	

87	CREATE TABLE HistoricoComprador (

88	    ID INT IDENTITY(1,1) PRIMARY KEY,

89	    RESERVAS INT DEFAULT 0,

90	    VISITAS INT DEFAULT 0

91	);

92	

93	CREATE TABLE Comprador (

94	    ID\_UTILIZADOR VARCHAR(50) PRIMARY KEY,

95	    ID\_Historico INT,

96	    LISTAFAVS VARCHAR(255),

97	    FOREIGN KEY (ID\_UTILIZADOR) REFERENCES Utilizador(USERNAME),

98	    FOREIGN KEY (ID\_Historico) REFERENCES HistoricoComprador(ID)

99	);

100	

101	CREATE TABLE Admin (

102	    ID\_UTILIZADOR VARCHAR(50) PRIMARY KEY,

103	    ESTATISTICAS VARCHAR(255),

104	    FOREIGN KEY (ID\_UTILIZADOR) REFERENCES Utilizador(USERNAME)

105	);

106	

107	-- ==========================================

108	-- (3) RELACIONAMENTOS / AÇÕES

109	-- ==========================================

110	

111	CREATE TABLE Comprar (

112	    ID\_COMPRADOR VARCHAR(50),

113	    ID\_VEICULO VARCHAR(15),

114	    ESTADO\_PAGAMENTO VARCHAR(30),

115	    PRIMARY KEY (ID\_COMPRADOR, ID\_VEICULO),

116	    FOREIGN KEY (ID\_COMPRADOR) REFERENCES Comprador(ID\_UTILIZADOR),

117	    FOREIGN KEY (ID\_VEICULO) REFERENCES Veiculo(MATRICULA)

118	);

119	

120	CREATE TABLE DataReserva (

121	    ID INT IDENTITY(1,1) PRIMARY KEY,

122	    DIA DATE,

123	    HORA TIME

124	);

125	

126	CREATE TABLE Reservar (

127	    ID\_COMPRADOR VARCHAR(50),

128	    ID\_ANUNCIO INT,

129	    ID\_DATA INT,

130	    PRIMARY KEY (ID\_COMPRADOR, ID\_ANUNCIO),

131	    FOREIGN KEY (ID\_COMPRADOR) REFERENCES Comprador(ID\_UTILIZADOR),

132	    FOREIGN KEY (ID\_ANUNCIO) REFERENCES Anuncio(ID),

133	    FOREIGN KEY (ID\_DATA) REFERENCES DataReserva(ID)

134	);

135	

136	CREATE TABLE Consultar (

137	    ID\_COMPRADOR VARCHAR(50),

138	    ID\_ANUNCIO INT,

139	    PRIMARY KEY (ID\_COMPRADOR, ID\_ANUNCIO),

140	    FOREIGN KEY (ID\_COMPRADOR) REFERENCES Comprador(ID\_UTILIZADOR),

141	    FOREIGN KEY (ID\_ANUNCIO) REFERENCES Anuncio(ID)

142	);

143	

144	CREATE TABLE Fazer (

145	    ID\_UTILIZADOR VARCHAR(50),

146	    ID\_DENUNCIA INT,

147	    PRIMARY KEY (ID\_UTILIZADOR, ID\_DENUNCIA),

148	    FOREIGN KEY (ID\_UTILIZADOR) REFERENCES Utilizador(USERNAME),

149	    FOREIGN KEY (ID\_DENUNCIA) REFERENCES Denuncias(ID)

150	);

151	

152	CREATE TABLE Gerir (

153	    ID\_ADMIN VARCHAR(50),

154	    ID\_UTILIZADOR VARCHAR(50),

155	    ID\_DENUNCIA INT,

156	    ID\_ANUNCIO INT,

157	    PRIMARY KEY (ID\_ADMIN, ID\_UTILIZADOR, ID\_DENUNCIA, ID\_ANUNCIO),

158	    FOREIGN KEY (ID\_ADMIN) REFERENCES Admin(ID\_UTILIZADOR),

159	    FOREIGN KEY (ID\_UTILIZADOR) REFERENCES Utilizador(USERNAME),

160	    FOREIGN KEY (ID\_DENUNCIA) REFERENCES Denuncias(ID),

161	    FOREIGN KEY (ID\_ANUNCIO) REFERENCES Anuncio(ID)

162	);

163	

164	CREATE TABLE Criar (

165	    ID\_VENDEDOR VARCHAR(50),

166	    ID\_ANUNCIO INT,

167	    PRIMARY KEY (ID\_VENDEDOR, ID\_ANUNCIO),

168	    FOREIGN KEY (ID\_VENDEDOR) REFERENCES Vendedor(ID\_UTILIZADOR),

169	    FOREIGN KEY (ID\_ANUNCIO) REFERENCES Anuncio(ID)

170	);

171	

172	CREATE TABLE Vender (

173	    ID\_VENDEDOR VARCHAR(50),

174	    ID\_VEICULO VARCHAR(15),

175	    PRIMARY KEY (ID\_VENDEDOR, ID\_VEICULO),

176	    FOREIGN KEY (ID\_VENDEDOR) REFERENCES Vendedor(ID\_UTILIZADOR),

177	    FOREIGN KEY (ID\_VEICULO) REFERENCES Veiculo(MATRICULA)

178	);

179	

180	CREATE TABLE MarcarVisita (

181	    ID\_COMPRADOR VARCHAR(50),

182	    ID\_ANUNCIO INT,

183	    PRIMARY KEY (ID\_COMPRADOR, ID\_ANUNCIO),

184	    FOREIGN KEY (ID\_COMPRADOR) REFERENCES Comprador(ID\_UTILIZADOR),

185	    FOREIGN KEY (ID\_ANUNCIO) REFERENCES Anuncio(ID)

186	);



